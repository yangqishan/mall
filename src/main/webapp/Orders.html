<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/css.css" rel="stylesheet" type="text/css" />
<link href="css/common.css" rel="stylesheet" tyle="text/css" />
<link href="css/Orders.css" rel="stylesheet" type="text/css" />
<script src="js/jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="js/jquery.reveal.js" type="text/javascript"></script>
<script src="js/jquery.SuperSlide.2.1.1.js" type="text/javascript"></script>
<script src="js/jquery.sumoselect.min.js" type="text/javascript"></script>
<script src="js/common_js.js" type="text/javascript"></script>
<script src="js/footer.js" type="text/javascript"></script>
<script src="js/jquery.jumpto.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/goods/getDetails.js"></script>
<title>确认订单界面</title>
</head>
 <script type="text/javascript">
        $(document).ready(function () {
            window.asd = $('.SlectBox').SumoSelect({ csvDispCount: 3 });
            window.test = $('.testsel').SumoSelect({okCancelInMulti:true });
        });
    </script>
<body>
<div id="Orders" class="Inside_pages  clearfix">
  <div class="Orders_style clearfix">
     <div class="address clearfix">
       <div class="title">收货人信息</div>
          <div class="adderss_list clearfix">
            <div class="title_name">选择收货地址 <a href="user_address.html">+添加地址</a></div>
             <div class="list" id="select">

             <ul v-if="index==flag" style="cursor: pointer" v-on:click="select(index)" v-bind:class="active" v-for="(a,index) of address">
              <div class="adderss_operating">
             <div class="Operate"><a href="#" class="delete_btn"></a> <a href="#" class="modify_btn"></a></div>
            </div>
             <div class="user_address">
            <li>{{a.name}}</li>
            <li>{{a.userAddress}}</li>
            <li class="Postcode">{{a.postcode}}</li>
            <li>{{a.email}}</li>
            <li>{{a.tel}}</li>
            </div>
            </ul>
                 <ul  v-else style="cursor: pointer" v-on:click="select(index)">
                     <div class="adderss_operating">
                         <div class="Operate"><a href="#" class="delete_btn"></a> <a href="#" class="modify_btn"></a></div>
                     </div>
                     <div class="user_address">
                         <li>{{a.name}}</li>
                         <li>{{a.userAddress}}</li>
                         <li class="Postcode">{{a.postcode}}</li>
                         <li>{{a.email}}</li>
                         <li>{{a.tel}}</li>
                     </div>
                 </ul>
            </div>
           </div>
        <!--收货地址样式-->
     <div class="Shipping_address">
       <ul class="detailed">
        <li><label>收货人姓名</label><span>{{ads.name}}</span></li>
         <li><label>账号</label><span>{{ads.userXh}}</span></li>
        <li><label>详细地址</label><span>{{ads.userAddress}}</span></li>
        <li><label>邮政编码</label><span>{{ads.postcode}}</span></li>
        <li><label>移动电话</label><span>{{ads.tel}}</span></li>
         <li><label>电子邮件</label><span>{{ads.email}}</span></li>
       </ul>
     </div>
     </div> 
        
     	<div class="form" method="post">
		<fieldset> 
     <!--快递选择-->
            <!-- <div class="express_delivery">
               <div class="title_name">选择快递方式</div>

                <ul class="dowebok">
                <li><input type="radio" name="radio" data-labelauty="圆通快递">
                  <div class="description">
                   <em class="arrow"></em>
                   <p>到付价格=现付价格*1.25 ，不足1元按1元收取，到付最低15元起。此价格供参考，详情请咨询圆通当地营业网点</p>
                   <p>资费：15元</p>
                   <p class="Note">满68元包邮</p>
                   <p><a href="#">点击查看是否在配送范围内</a></p>
                  </div>
                </li>
                <li><input type="radio" name="radio" data-labelauty="中通快递">
                 <div class="description">
                   <em class="arrow"></em>
                   <p>到付价格=现付价格*1.25 ，不足1元按1元收取，到付最低15元起。此价格供参考，详情请咨询圆通当地营业网点</p>
                   <p>资费：15元</p>
                   <p class="Note">满68元包邮</p>
                  </div>
                </li>
                <li><input type="radio" name="radio" data-labelauty="申通快递">
                 <div class="description">
                   <em class="arrow"></em>
                   <p>到付价格=现付价格*1.25 ，不足1元按1元收取，到付最低15元起。此价格供参考，详情请咨询圆通当地营业网点</p>
                   <p>资费：15元</p>
                   <p class="Note">满68元包邮</p>
                  </div>
                </li>
                <li><input type="radio" name="radio" data-labelauty="邮政EMS">
                 <div class="description">
                   <em class="arrow"></em>
                   <p>到付价格=现付价格*1.25 ，不足1元按1元收取，到付最低15元起。此价格供参考，详情请咨询圆通当地营业网点</p>
                   <p>资费：15元</p>
                   <p class="Note">满68元包邮</p>
                  </div>
                </li>
                <li><input type="radio" name="radio" data-labelauty="城际快递">
                 <div class="description">
                   <em class="arrow"></em>
                   <p>到付价格=现付价格*1.25 ，不足1元按1元收取，到付最低15元起。此价格供参考，详情请咨询圆通当地营业网点</p>
                   <p>资费：同城包邮</p>

                  </div>
                </li>
                <li><input type="radio" name="radio" data-labelauty="韵达快递">
                 <div class="description">
                   <em class="arrow"></em>
                   <p>到付价格=现付价格*1.25 ，不足1元按1元收取，到付最低15元起。此价格供参考，详情请咨询圆通当地营业网点</p>
                   <p>资费：15元</p>
                   <p class="Note">满68元包邮</p>
                  </div>
                </li>
                <li><input type="radio" name="radio" data-labelauty="国通快递">
                 <div class="description">
                   <em class="arrow"></em>
                   <p>到付价格=现付价格*1.25 ，不足1元按1元收取，到付最低15元起。此价格供参考，详情请咨询圆通当地营业网点</p>
                   <p>资费：15元</p>
                   <p class="Note">满68元包邮</p>
                  </div>
                </li>
                <li><input type="radio" name="radio" data-labelauty="顺丰快递">
                 <div class="description">
                   <em class="arrow"></em>
                   <p>到付价格=现付价格*1.25 ，不足1元按1元收取，到付最低15元起。此价格供参考，详情请咨询圆通当地营业网点</p>
                   <p>资费：15元</p>
                   <p class="Note">满88元包邮</p>
                  </div>
                </li>
                <li><input type="radio" name="radio" data-labelauty="邮政小包">
                 <div class="description">
                   <em class="arrow"></em>
                   <p>到付价格=现付价格*1.25 ，不足1元按1元收取，到付最低15元起。此价格供参考，详情请咨询圆通当地营业网点</p>
                   <p>资费：15元</p>
                   <p class="Note">满68元包邮</p>
                  </div>
                </li>
                <li><input type="radio" name="radio" data-labelauty="天天快递">
                 <div class="description">
                   <em class="arrow"></em>
                   <p>到付价格=现付价格*1.25 ，不足1元按1元收取，到付最低15元起。此价格供参考，详情请咨询圆通当地营业网点</p>
                   <p>资费：15元</p>
                   <p class="Note">满68元包邮</p>
                  </div>
                </li>
                </ul>   -->
      
     </div>
    
     <!--付款方式-->
     <div class="payment">
      <div class="title_name">支付方式</div>
       <ul>
        <li v-for="(p,index) of pays" v-on:click="pay(index)"><input type="radio" name="radio" v-bind:data-labelauty="p"></li>
       </ul>
     </div>
      <!--发票样式-->
     <div class="invoice_style">
       <ul>
         <li class="invoice_left"><input name="" type="checkbox" value="" data-labelauty="是否开发票"/> </li>
         <li class="invoice_left"><select name="somename" class="SlectBox" onclick="console.log($(this).val())" onchange="console.log('change is firing')">
              <option disabled="disabled" selected="selected">发票类型</option>
              <option value="办公用品">办公用品</option>
              <option value="食品">食品</option>
              <option value="20元红包">20元红包</option>
              <option value="50元红包">50元红包</option>
              <option value="100元红包">100元红包</option>
              <option value="200元红包">200元红包</option>
            </select>
         </li>
         <li class="invoice_left">发票抬头
         <input name="" type="text" class="text_info" /></li>
         <li class="invoice_left">
         <select name="somename" class="SlectBox" onclick="console.log($(this).val())" onchange="console.log('change is firing')">
              <option disabled="disabled" selected="selected">发票内容</option>
              <option value="办公用品">办公用品</option>
              <option value="食品">食品</option>
              <option value="数码配件">数码配件</option>
              <option value="电脑">电脑</option>
              <option value="手机">手机</option>
              <option value="200元红包">200元红包</option>
            </select>
         
         </li>
        </ul>
     </div>
     <!--产品列表-->
     <div class="Product_List">
     <!--<div class="envelopes">
     选择已有红包<select name="somename" class="SlectBox" onclick="console.log($(this).val())" onchange="console.log('change is firing')">
			        <option disabled="disabled" selected="selected">选择红包金额</option>
			        &lt;!&ndash;placeholder&ndash;&gt;
			        <option value="5元红包">5元红包</option>
			        <option value="10元红包">10元红包</option>
			        <option value="20元红包">20元红包</option>
			        <option value="50元红包">50元红包</option>
                    <option value="100元红包">100元红包</option>
                    <option value="200元红包">200元红包</option>
			    </select>
                或者输入红包序列号<input name="" type="text" class="text_number" /><input type="submit"  class="verification_btn" value="验证序列号"/>
     </div>-->
      <table>
       <thead><tr class="title"><td class="name">商品名称</td><td class="price">商品价格</td><td class="Preferential">优惠价</td><td class="Quantity">购买数量</td><td class="Money">金额</td></tr></thead>
       <tbody>
       <tr v-for="product of products">
        <td class="Product_info">
         <a href="#"><img v-bind:src="product.img"  width="100px" height="100px"/></a>
         <a href="#" class="product_name">{{product.name}}</a>
            <a href="#" class="product_name" style="color: red">{{product.flag}}</a>
         </td>
        <td><i>￥</i>{{product.price}}</td>
        <td v-if="product.flag=='积分'">{{product.discountPrice}}积分</td>
        <td v-else><i>￥</i>{{product.discountPrice}}</td>

        <td>{{product.number}}</td>
        <td class="Moneys"  v-if="product.flag!='积分'"><i>￥</i>{{product.number*product.discountPrice}}</td>
           <td class="Moneys" v-else>{{product.discountPrice}}积分</td>
       </tr>

       </tbody>
      </table>
      <div class="Pay_info">
       <label>订单留言</label><input name="" type="text"  onkeyup="checkLength(this);" class="text_name " />  <span class="wordage">剩余字数：<span id="sy" style="color:Red;">50</span></span>  
      </div>
      <!--价格-->
      <div class="price_style">
      <div class="right_direction">
        <ul>
         <li v-if="type=='积分'"><label>商品总价</label><i></i><span>{{money}}积分</span></li>
            <li v-else><label>商品总价</label><i>￥</i><span>{{money}}</span></li>
         <li><label>配&nbsp;&nbsp;送&nbsp;&nbsp;费</label><i>￥</i><span>0</span></li>
         <li class="shiji_price" v-if="type!='积分'"><label>实&nbsp;&nbsp;付&nbsp;&nbsp;款</label><i>￥</i><span>{{money}}</span></li>
            <li class="shiji_price" v-else><label>实&nbsp;&nbsp;付&nbsp;&nbsp;款</label><i>￥</i><span>0</span></li>
        </ul>   
        <div class="btn"><input name="submit" v-on:click="createOrder()" value="提交订单" class="submit_btn"/> <input name=""  type="button" value="返回购物车"  class="return_btn"/></div>
         <div class="integral right" v-if="type!='积分'">待订单确认后，你将获得<span>{{money}}</span>积分</div>
          <div class="integral right" v-else>待订单确认后，你将获得<span>0</span>积分</div>
      </div>
      </div>
     </div>  
     </fieldset>
        </div>
  </div>
</div>
<script src="./lib/layui/layui.js" charset="utf-8"></script>
<script src="./js/x-admin.js"></script>
<script src="./js/x-layui.js" charset="utf-8"></script>
<script type="text/javascript" src="js/vue.js"></script>
<script type="text/javascript">
function checkLength(which) {
	var maxChars = 50; //
	if(which.value.length > maxChars){
		alert("您出入的字数超多限制!");
		// 超过限制的字数了就将 文本框中的内容按规定的字数 截取
		which.value = which.value.substring(0,maxChars);
		return false;
	}else{
		var curr = maxChars - which.value.length; //250 减去 当前输入的
		document.getElementById("sy").innerHTML = curr.toString();
		return true;
	}
}
</script>
<script>
$(function(){
	$(':input').labelauty();
});
</script>
<script type="text/javascript">
    layui.use(['laydate','element','laypage','layer'], function(){
        $ = layui.jquery;//jquery
        laydate = layui.laydate;//日期插件
        lement = layui.element();//面包导航
        laypage = layui.laypage;//分页
        layer = layui.layer;//弹出层

    });

    var app=new Vue({
        el:"#Orders",
        data:{
            address:[],//地址信息
            ads:[],//选中地址
            products:[],//商品
            pays:["余额支付","支付宝","财付通","银联支付","货到付款"],
            active:'',
            flag:0,
            payss:'',//支付方式
            money:'',//总价
            number:'',//总数量
            type:''//商品类型
        },
        methods:{
            //支付方式
            pay:function (id) {
                this.payss=this.pays[id]
            },
            //选择地址
            select:function (id) {
                this.active='confirm active'
                this.flag=id
                this.ads=this.address[id]
                //$("#select"+id).attr("calss","confirm active")
            },
            //创建订单
            createOrder:function () {

                if(this.payss==""||this.ads.id==""){
                    layer.msg("没有选择地址或者支付方式",{icon:2,time:1500})
                    return false
                }
                //订单生成
                createOrders(this.number,this.money,this.payss,this.ads.id,this.type)
            }
        }
    })
    //页面加载自动执行
    $(document).ready(function () {

        var id=getQueryString("id")//商品id(或者数组)
        var userId=getQueryString("userId")//会员账号(或者字符串数组)
        var flag=getQueryString("flag")//标识(或者字符串数组)
        var number=getQueryString("number")//数量(或者字符串数组)
        var price=getQueryString("price")//价格(或者字符串数组)
        //获取选中商品的信息和收货地址
        $.ajax({
            url:"goods/orders",
            type:"post",
            dataType:"json",
            data:{
                goodsId:id,
                userXh:userId,
                flag:flag,
                number:number,
                price:price,
            },
            success:function (data) {
               app.address=data.data.address
                app.products=data.data.products
                var money=0//总金额
                var num=0//总数
                for(var i=0;i<data.data.products.length;i++){
                    money+=data.data.products[i].discountPrice*Number(data.data.products[i].number)
                    num+=Number(data.data.products[i].number)
                    app.type=data.data.products[i].flag
                }
                app.number=num
                app.money=money
            }
        })
    })
    //获取路径上的参数
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null)
            return decodeURI(r[2]);
        return null;
    }
</script>
</body>
</html>
